<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
		<title></title>

		<link rel="stylesheet" type="text/css" href="css/base.min.css" />
		<style>
			html,
			body {
				height: 100%;
				width: 100%;
				background: #fcfcfc;
			}
			
			.header {
				padding: 0;
			}
			
			.header p {
				margin: 0;
			}
			
			#dairyList {
				margin: 0;
			}
			
			#footer {
				position: fixed;
				bottom: 0px;
				right: 10px;
				z-index: 99999 !important;
			}
			
			#footer p {
				/*text-align: center;*/
				color: #636363;
			}
			
			#footer .row p {
				text-align: center;
			}
		</style>
	</head>

	<body>

		<div id="dairyList" class="tile-wrap">

		</div>
		<footer id="footer">
			<a onclick="openWrite();" class="btn fbtn fbtn-brand waves-attach waves-circle waves-light">
				<span class="icon">add</span>
			</a>
		</footer>

	</body>

	<script src="js/appcan/appcan.js"></script>
	<script src="js/appcan/appcan.control.js"></script>
	<script type="text/javascript" src="js/lib/jquery-2.2.1.min.js"></script>
	<script src="js/lib/base.min.js"></script>

	<script>
		var token = appcan.locStorage.getVal('token');
		appcan.ready(function() {
			//从云端获取列表
			dairyList();
		});

		function dairyList() {
			$('#dairyList').text('');
			var url = 'http://192.168.155.1:8080/Match/babyBuddy/public/api/dairy';
			$.ajax({
				url: url,
				type: 'get',
				headers: {
					'Authorization': ' Bearer ' + token
				},
				success: function(d) {
					//					alert(234);
					for (var key in d.data) {
						$str = '<div class="tile"><div class="tile-action tile-action-show"><ul class="margin-no nav nav-list pull-right"><li><a class="text-black-sec waves-attach waves-effect"><img name="' + d.data[key].id + '"onclick="dairyUpdate(this);"class="icon"src="img/iconfont-bofang.png "></a></li><li><a class="text-black-sec waves-attach waves-effect"><img name="' + d.data[key].id + '"onclick="dairyDelete(this);"class="icon"src="img/iconfont-iconfontshanchu.png"></a></li></ul></div><div class="tile-inner"><span class="text-overflow">' + d.data[key].title + '</span></div></div>';
						$('#dairyList').append($str);
					}
				},
				error: function(e) {
					alert("错误！");
					console.log(e);
				}
			});
		}

		function dairyDelete(o) {
			var id = $(o).attr('name');
			var url = 'http://192.168.155.1:8080/Match/babyBuddy/public/api/dairy/delete/' + id;
			$.ajax({
				url: url + 'user',
				type: 'POST',
				headers: {
					'Authorization': 'Bearer ' + token
				},
				success: function(d) {
					alert(d.message);
					dairyList();
				},
				error: function(e) {
					alert(e);
					console.log(e);
				}
			});
		}

		function openWirte() {
			appcan.frame.open({
				id: 'dairyWrite',
				url: 'dairyWrite.html',
				top: 0,
				left: 0
			});
		}

		function dairyUpdate() {
		}
	</script>

</html>